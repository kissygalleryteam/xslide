/*!build time : 2014-05-27 2:32:41 PM*/
KISSY.add("gallery/xslide/1.0/drag",function(a){function b(a){return a.changedTouches.length>1?void(l=!0):(o=[],n={},n.startX=a.touches[0].clientX,n.startY=a.touches[0].clientY,n.deltaX=0,n.deltaY=0,a.touch=n,o.push({deltaX:n.deltaX,deltaY:n.deltaY,timeStamp:a.timeStamp}),a.deltaX=n.deltaX,a.deltaY=n.deltaY,void m(a.target).fire(g,a))}function c(a){a.changedTouches.length>1||(o.length?(n.deltaX=a.touches[0].clientX-n.startX,n.deltaY=a.touches[0].clientY-n.startY,a.touch=n,o.push({deltaX:n.deltaX,deltaY:n.deltaY,timeStamp:a.timeStamp}),a.deltaX=n.deltaX,a.deltaY=n.deltaY,a.velocityX=0,a.velocityY=0,a.isPropagationStopped()||m(a.target).fire(i,a)):(n={},n.startX=a.touches[0].clientX,n.startY=a.touches[0].clientY,n.deltaX=0,n.deltaY=0,a.touch=n,o.push({deltaX:n.deltaX,deltaY:n.deltaY,timeStamp:a.timeStamp}),a.deltaX=n.deltaX,a.deltaY=n.deltaY,m(a.target).fire(g,a)))}function d(a){var b=0,c=0,d=0;if(!(a.changedTouches.length>1)){n.deltaX=a.changedTouches[0].clientX-n.startX,n.deltaY=a.changedTouches[0].clientY-n.startY,a.deltaX=n.deltaX,a.deltaY=n.deltaY,a.touch=n,a.touch.record=o;var g=(a.touch.startX,a.touch.startY,o.length),i=o[0]&&o[0].timeStamp;if(!(2>g)&&i){{o[g-1].timeStamp-o[0].timeStamp}for(var j in o)j>0?(o[j].velocity=e(o[j].deltaX,o[j].deltaY,o[j-1].deltaX,o[j-1].deltaY)/(o[j].timeStamp-o[j-1].timeStamp),o[j].velocityX=(o[j].deltaX-o[j-1].deltaX)/(o[j].timeStamp-o[j-1].timeStamp),o[j].velocityY=(o[j].deltaY-o[j-1].deltaY)/(o[j].timeStamp-o[j-1].timeStamp)):(o[j].velocity=0,o[j].velocityX=0,o[j].velocityY=0);var l=o[0].velocityX/Math.abs(o[0].velocityX);for(var j in o)o[j].velocityX/Math.abs(o[j].velocityX)!=l&&(l=o[j].velocityX/Math.abs(o[j].velocityX),d=j);var p=o[0].velocityY/Math.abs(o[0].velocityY);for(var j in o)o[j].velocityY/Math.abs(o[j].velocityY)!=p&&(p=o[j].velocityY/Math.abs(o[j].velocityY),c=j);b=Math.max(d,c);{o[b]}a.touch.record=a.touch.record.splice(b-1);var q=f(a.touch.record);a.velocityX=Math.abs(q.velocityX)>k?q.velocityX/Math.abs(q.velocityX)*k:q.velocityX,a.velocityY=Math.abs(q.velocityY)>k?q.velocityY/Math.abs(q.velocityY)*k:q.velocityY,a.velocity=Math.sqrt(Math.pow(a.velocityX,2)+Math.pow(a.velocityY,2)),m(a.target).fire(h,a),n={},o=[]}}}function e(a,b,c,d){return Math.sqrt(Math.pow(c-a,2)+Math.pow(d-b,2))}function f(a){for(var b=0,c=0,d=a.length,e=0;d>e;e++)b+=a[e].velocityY,c+=a[e].velocityX;return b/=d,c/=d,{velocityY:Math.abs(a[d-1].velocityY)>j?b:0,velocityX:Math.abs(a[d-1].velocityX)>j?c:0}}var g=(window.document,"gestureDragStart"),h="gestureDragEnd",i="gestureDrag",j=.35,k=8,l=!1,m=a.all,n={},o=[];return a.each([i],function(e){a.Event.Special[e]={setup:function(){m(this).on("touchstart",b),m(this).on("touchmove",c),m(this).on("touchend",d)},teardown:function(){m(this).detach("touchstart",b),m(this).detach("touchmove",c),m(this).detach("touchend",d)}}}),{DRAG_START:g,DRAG:i,DRAG_END:h}},{requires:["node"]}),KISSY.add("gallery/xslide/1.0/index",function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q=a.all,r=".ks-xslide-",s=r+"layer",t=r+"item",u=r+"nav",v="ks-xslide-nav-item",w=!1,x=0,y=.2,z=5,A=c.extend({transform:function(a,b){var c=["-webkit-","-moz-","-o-",""];for(var d in b)for(var e in c)a.style[c[e]+"transform"]=d+b[d]},initializer:function(){var a=this;e=a.userConfig,l=a.$renderTo=q(e.renderTo),w=e.crousel,e.renderTo&&l[0]&&(a.curIndex=0,x=0,m=a.$layer=q(s,l),n=a.$items=q(t,m),o=a.$nav=q(u,l),f=a.itemNum=n.length,f&&(2>=f&&(w=!1),a.render()))},render:function(){var a=this;if(i=e.width||l.width()||30,j=e.height||l.height()||30,h=e.itemWidth||n.width()||i,g=e.itemHeight||n.height()||j,k=a.itemNum*h,l.css({height:j+"px",width:i+"px",overflow:"hidden",position:"relative"}),m.css({position:"absolute",height:g+"px",width:k}),a.transform(m[0],{translateX:"(0px) translateZ(0px)"}),n.css({display:"block",width:h+"px",height:g+"px",position:"absolute"}),q("li",o)&&!q("li",o).length){for(var b="",c=1;c<=a.itemNum;c++)b+="<li class='"+v+"'>"+c+"</li>";p=a.$navItems=q(b).appendTo(o)}else p=q("li",o);a.evtBind(),p.removeClass("current").item(0).addClass("current");for(var c=0;f>c;c++)a.put(c,c);w&&a.put(f-1,-1)},pop:function(a){var b=a.length;return a[b-1]},getPosX:function(){var a=this;return Number(window.getComputedStyle(a.$layer[0]).webkitTransform.match(/[-\d]+/g)[4])},setPosX:function(a){var b=this;m[0].style.webkitTransition="",b.transform(m[0],{translateX:"("+a+"px) translateZ(0px)"})},getPrev:function(){var a=this,b=a.curIndex;return this.$items.item((b-1+f)%f)},getNext:function(){var a=this,b=a.curIndex;return this.$items.item((b+1)%f)},getCurrent:function(){var a=this,b=a.curIndex;return this.$items.item(b)},getItem:function(a){return this.$items.item(0>a?a%f+f:a%f)},evtBind:function(){var a,b=this,c=0,e=[c];l.on(d.DRAG_START,function(){c=b.getPosX(),b.fire("beforeSlide",{curIndex:b.curIndex}),b.set("enable",!0)}).on(d.DRAG,function(d){0!=b.get("enable")&&(Math.abs(d.deltaX)>z||Math.abs(d.deltaX)>Math.abs(d.deltaY)?(d.preventDefault(),d.stopPropagation(),b.judgePos(),a=b.pop(e),e.push(c+d.deltaX),b.setPosX(c+d.deltaX),b.direction=a>c+d.deltaX?"left":"right",b.computePos(),b.fire("slide",{direction:b.direction})):b.set("enable",!1))}).on(d.DRAG_END,function(a){if(Math.abs(a.velocityX)<y)b.animTo(b.judgePos());else{var c=a.velocityX>0?"right":"left",d="right"==c?x-1:x+1;b.direction=c,b.animTo(d)}}),b.on("beforeAnim",function(){b.computePos()}),m[0].addEventListener("webkitTransitionEnd",function(){b.fire("afterSlide",{curIndex:b.curIndex})},!1)},animTo:function(a){var b=this;w&&(x=a),0>a?a=0:a>b.itemNum-1&&(a=b.itemNum-1);var c=w?h*x:h*a,d=.4,e="ease-out";b.transform(m[0],{translateX:"("+-c+"px) translateZ(0px)"}),m[0].style.webkitTransition="-webkit-transform "+d+"s "+e+" 0s",b.curIndex=w?0>x%f?f+x%f:x%f:a,p.removeClass("current").item(b.curIndex).addClass("current"),n.removeClass("current").item(b.curIndex).addClass("current"),b.fire("beforeAnim",{direction:b.direction})},getCurrentIndex:function(){return this.curIndex||0},judgePos:function(){var a=this,b=a.getPosX();return a.direction=-b/h-Math.floor(-b/h)>=.5?"left":"right",x=Math.round(-b/h),a.curIndex=0>x%f?f+x%f:x%f,x},computePos:function(){var a=this,b=a.curIndex;w&&("right"==a.direction?a.put(b-1,x-1):"left"==a.direction&&a.put(b+1,x+1))},put:function(a,b){var c=this;0>a?a=f-1:a>f-1&&(a=0),c.transform(n.item(a)[0],{translateX:"("+b*h+"px) translateZ(0px)"})}});return A},{requires:["node","base","./drag"]});