/*!build time : 2014-06-04 11:48:26 AM*/
KISSY.add("gallery/xslide/1.0/drag",function(a){function b(a){return a.changedTouches.length>1?void(l=!0):(o=[],n={},n.startX=a.touches[0].clientX,n.startY=a.touches[0].clientY,n.deltaX=0,n.deltaY=0,a.touch=n,o.push({deltaX:n.deltaX,deltaY:n.deltaY,timeStamp:a.timeStamp}),a.deltaX=n.deltaX,a.deltaY=n.deltaY,void m(a.target).fire(g,a))}function c(a){a.changedTouches.length>1||(o.length?(n.deltaX=a.touches[0].clientX-n.startX,n.deltaY=a.touches[0].clientY-n.startY,a.touch=n,o.push({deltaX:n.deltaX,deltaY:n.deltaY,timeStamp:a.timeStamp}),a.deltaX=n.deltaX,a.deltaY=n.deltaY,a.velocityX=0,a.velocityY=0,a.isPropagationStopped()||m(a.target).fire(i,a)):(n={},n.startX=a.touches[0].clientX,n.startY=a.touches[0].clientY,n.deltaX=0,n.deltaY=0,a.touch=n,o.push({deltaX:n.deltaX,deltaY:n.deltaY,timeStamp:a.timeStamp}),a.deltaX=n.deltaX,a.deltaY=n.deltaY,m(a.target).fire(g,a)))}function d(a){var b=0,c=0,d=0;if(!(a.changedTouches.length>1)){n.deltaX=a.changedTouches[0].clientX-n.startX,n.deltaY=a.changedTouches[0].clientY-n.startY,a.deltaX=n.deltaX,a.deltaY=n.deltaY,a.touch=n,a.touch.record=o;var g=(a.touch.startX,a.touch.startY,o.length),i=o[0]&&o[0].timeStamp;if(!(2>g)&&i){{o[g-1].timeStamp-o[0].timeStamp}for(var j in o)j>0?(o[j].velocity=e(o[j].deltaX,o[j].deltaY,o[j-1].deltaX,o[j-1].deltaY)/(o[j].timeStamp-o[j-1].timeStamp),o[j].velocityX=(o[j].deltaX-o[j-1].deltaX)/(o[j].timeStamp-o[j-1].timeStamp),o[j].velocityY=(o[j].deltaY-o[j-1].deltaY)/(o[j].timeStamp-o[j-1].timeStamp)):(o[j].velocity=0,o[j].velocityX=0,o[j].velocityY=0);var l=o[0].velocityX/Math.abs(o[0].velocityX);for(var j in o)o[j].velocityX/Math.abs(o[j].velocityX)!=l&&(l=o[j].velocityX/Math.abs(o[j].velocityX),d=j);var p=o[0].velocityY/Math.abs(o[0].velocityY);for(var j in o)o[j].velocityY/Math.abs(o[j].velocityY)!=p&&(p=o[j].velocityY/Math.abs(o[j].velocityY),c=j);b=Math.max(d,c);{o[b]}a.touch.record=a.touch.record.splice(b-1);var q=f(a.touch.record);a.velocityX=Math.abs(q.velocityX)>k?q.velocityX/Math.abs(q.velocityX)*k:q.velocityX,a.velocityY=Math.abs(q.velocityY)>k?q.velocityY/Math.abs(q.velocityY)*k:q.velocityY,a.velocity=Math.sqrt(Math.pow(a.velocityX,2)+Math.pow(a.velocityY,2)),m(a.target).fire(h,a),n={},o=[]}}}function e(a,b,c,d){return Math.sqrt(Math.pow(c-a,2)+Math.pow(d-b,2))}function f(a){for(var b=0,c=0,d=a.length,e=0;d>e;e++)b+=a[e].velocityY,c+=a[e].velocityX;return b/=d,c/=d,{velocityY:Math.abs(a[d-1].velocityY)>j?b:0,velocityX:Math.abs(a[d-1].velocityX)>j?c:0}}var g=(window.document,"gestureDragStart"),h="gestureDragEnd",i="gestureDrag",j=.35,k=8,l=!1,m=a.all,n={},o=[];return a.each([i],function(e){a.Event.Special[e]={setup:function(){m(this).on("touchstart",b),m(this).on("touchmove",c),m(this).on("touchend",d)},teardown:function(){m(this).detach("touchstart",b),m(this).detach("touchmove",c),m(this).detach("touchend",d)}}}),{DRAG_START:g,DRAG:i,DRAG_END:h}},{requires:["node","event"]}),KISSY.add("gallery/xslide/1.0/index",function(a,b,c,d){var e=a.all,f=".ks-xslide-",g=f+"layer",h=f+"item",i=f+"nav",j="ks-xslide-nav-item",k=0,l=.2,m=5,n=c.extend({transform:function(a,b){var c=["-webkit-","-moz-","-o-",""];for(var d in b)for(var e in c)a.style[c[e]+"transform"]=d+b[d]},initializer:function(){var a=this,b=a.userConfig,c=a.$renderTo=e(b.renderTo);if(a.crousel=b.crousel,b.renderTo&&c[0]){a.curIndex=0,k=0;var d=a.$layer=e(g,c),f=a.$items=e(h,d),j=(a.$nav=e(i,c),a.itemNum=f.length);j&&(2>=j&&(a.crousel=!1),a.render())}},render:function(){var a,b=this,c=b.userConfig,d=b.$renderTo,f=b.$layer,g=b.$items,h=b.$nav,i=c.width||d.width()||300,k=c.height||d.height()||50,l=b.itemWidth=c.itemWidth||i,m=b.itemNum,n=c.itemHeight||k;if(b.layWidth=b.itemNum*l,d.css({height:k+"px",width:i+"px",overflow:"hidden",position:"relative"}),f.css({position:"absolute",height:n+"px",width:b.layWidth}),b.transform(f[0],{translateX:"(0px) translateZ(0px)"}),g.css({display:"block",width:l+"px",height:n+"px",position:"absolute"}),e("li",h)&&!e("li",h).length){for(var o="",p=1;p<=b.itemNum;p++)o+="<li class='"+j+"'>"+p+"</li>";a=b.$navItems=e(o).appendTo(h)}else a=b.$navItems=e("li",h);b.evtBind(),a.removeClass("current").item(0).addClass("current");for(var p=0;m>p;p++)b.put(p,p);b.crousel&&b.put(m-1,-1)},pop:function(a){var b=a.length;return a[b-1]},getPosX:function(){var a=this;return Number(window.getComputedStyle(a.$layer[0]).webkitTransform.match(/[-\d]+/g)[4])},setPosX:function(a){var b=this;b.$layer[0].style.webkitTransition="",b.transform(b.$layer[0],{translateX:"("+a+"px) translateZ(0px)"})},getPrev:function(){var a=this,b=a.curIndex;return a.$items.item((b-1+a.itemNum)%a.itemNum)},getNext:function(){var a=this,b=a.curIndex;return a.$items.item((b+1)%a.itemNum)},getCurrent:function(){var a=this,b=a.curIndex;return a.$items.item(b)},getItem:function(a){return this.$items.item(0>a?a%self.itemNum+self.itemNum:a%self.itemNum)},evtBind:function(){{var a,b=this,c=0,e=[c],f=b.$renderTo,g=b.$layer;b.$items,b.$nav,b.$navItems}f.on(d.DRAG_START,function(){c=b.getPosX(),b.fire("beforeSlide",{curIndex:b.curIndex}),b.set("enable",!0)}).on(d.DRAG,function(d){0!=b.get("enable")&&(Math.abs(d.deltaX)>m||Math.abs(d.deltaX)>Math.abs(d.deltaY)?(d.preventDefault(),d.stopPropagation(),b.judgePos(),a=b.pop(e),e.push(c+d.deltaX),b.setPosX(c+d.deltaX),b.direction=a>c+d.deltaX?"left":"right",b.computePos(),b.fire("slide",{direction:b.direction})):b.set("enable",!1))}).on(d.DRAG_END,function(a){if(Math.abs(a.velocityX)<l)b.animTo(b.judgePos());else{var c=a.velocityX>0?"right":"left",d="right"==c?k-1:k+1;b.direction=c,b.animTo(d)}}),b.on("beforeAnim",function(){b.computePos()}),g[0].addEventListener("webkitTransitionEnd",function(){b.fire("afterSlide",{curIndex:b.curIndex})},!1)},animTo:function(a){var b=this,c=(b.$renderTo,b.$layer),d=b.$items,e=(b.$nav,b.itemWidth),f=b.itemNum;b.crousel&&(k=a),0>a?a=0:a>b.itemNum-1&&(a=b.itemNum-1);var g=b.crousel?e*k:e*a,h=.4,i="ease-out";b.transform(c[0],{translateX:"("+-g+"px) translateZ(0px)"}),c[0].style.webkitTransition="-webkit-transform "+h+"s "+i+" 0s",b.curIndex=b.crousel?0>k%f?f+k%f:k%f:a,b.$navItems.removeClass("current").item(b.curIndex).addClass("current"),d.removeClass("current").item(b.curIndex).addClass("current"),b.fire("beforeAnim",{direction:b.direction})},judgePos:function(){var a=this,b=a.itemNum,c=a.itemWidth,d=a.getPosX();return a.direction=-d/c-Math.floor(-d/c)>=.5?"left":"right",k=Math.round(-d/c),a.curIndex=0>k%b?b+k%b:k%b,k},computePos:function(){{var a=this,b=a.curIndex;a.itemNum-1}a.crousel&&("right"==a.direction?a.put(b-1,k-1):"left"==a.direction&&a.put(b+1,k+1))},put:function(a,b){var c=this,d=c.itemNum,e=c.itemWidth;0>a?a=d-1:a>d-1&&(a=0),c.transform(c.$items.item(a)[0],{translateX:"("+b*e+"px) translateZ(0px)"})}});return n},{requires:["node","base","./drag"]});